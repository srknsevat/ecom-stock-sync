<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Ecom Stock Sync - Yönetim</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style> body{padding:24px} pre{background:#f8f9fa;padding:12px;border-radius:6px} </style>
  <script>
    async function loadMetrics(){
      const res = await fetch('/actuator/integration-metrics');
      const data = await res.json();
      document.getElementById('metrics').textContent = JSON.stringify(data, null, 2);
    }
    async function loadPlatforms(){
      const res = await fetch('/api/platforms');
      const data = await res.json();
      const sel = document.getElementById('platformSelect');
      sel.innerHTML = '';
      data.forEach(p=>{
        const opt=document.createElement('option');
        opt.value=p.id; opt.textContent=`${p.id} - ${p.name || p.code || 'Platform'}`;
        sel.appendChild(opt);
      });
      if (data.length>0){
        sel.value = data[0].id;
        await loadRequiredCredentialTypes();
      }
    }
    async function loadRequiredCredentialTypes(){
      const id = document.getElementById('platformSelect').value;
      if(!id) return;
      const res = await fetch(`/api/platforms/${id}/credentials`);
      let data = [];
      try { data = await res.json(); } catch(e){ data = []; }
      const list = document.getElementById('requiredTypes');
      list.innerHTML = '';
      if (Array.isArray(data) && data.length){
        data.forEach(t=>{
          const li = document.createElement('li'); li.textContent = t; list.appendChild(li);
        });
      } else {
        list.innerHTML = '<li>Tanımlı zorunlu alan yok</li>';
      }
    }
    async function testPlatform(){
      const id = document.getElementById('platformId').value;
      const res = await fetch(`/api/platforms/${id}/test`);
      const data = await res.json();
      document.getElementById('testResult').textContent = JSON.stringify(data, null, 2);
    }
    async function saveCredential(){
      const id = document.getElementById('platformSelect').value;
      const type = document.getElementById('credType').value;
      const value = document.getElementById('credValue').value;
      const res = await fetch(`/api/platforms/${id}/credentials`,{method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({credentialType:type, credentialValue:value})});
      document.getElementById('credMsg').textContent = res.ok? 'Kaydedildi' : 'Kaydedilemedi';
      if(res.ok){ document.getElementById('credValue').value=''; }
    }
    async function deleteCredential(){
      const id = document.getElementById('platformSelect').value;
      const type = document.getElementById('credType').value;
      const res = await fetch(`/api/platforms/${id}/credentials/${encodeURIComponent(type)}`,{method:'DELETE'});
      document.getElementById('credMsg').textContent = res.ok? 'Silindi' : 'Silinemedi';
    }
    window.addEventListener('load', ()=>{ loadMetrics(); loadPlatforms(); });
  </script>
  </head>
<body>
  <div class="container">
    <h1 class="mb-4">Ecom Stock Sync - Yönetim</h1>
    <div class="row g-4">
      <div class="col-md-6">
        <div class="card">
          <div class="card-header">Entegrasyon Metrikleri</div>
          <div class="card-body">
            <button class="btn btn-sm btn-outline-primary mb-2" onclick="loadMetrics()">Yenile</button>
            <pre id="metrics">yükleniyor...</pre>
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="card">
          <div class="card-header">Platform Bağlantı Testi</div>
          <div class="card-body">
            <div class="input-group mb-2">
              <span class="input-group-text">Platform ID</span>
              <input id="platformId" type="number" class="form-control" placeholder="örn. 1">
              <button class="btn btn-success" onclick="testPlatform()">Test Et</button>
            </div>
            <pre id="testResult"></pre>
          </div>
        </div>
      </div>
      <div class="col-12">
        <div class="card">
          <div class="card-header">Platform Credential Yönetimi</div>
          <div class="card-body">
            <div class="row g-2 align-items-end">
              <div class="col-md-3">
                <label class="form-label">Platform</label>
                <select id="platformSelect" class="form-select" onchange="loadRequiredCredentialTypes()"></select>
              </div>
              <div class="col-md-3">
                <label class="form-label">Credential Type</label>
                <input id="credType" class="form-control" placeholder="örn. API_KEY"/>
              </div>
              <div class="col-md-4">
                <label class="form-label">Credential Value</label>
                <input id="credValue" class="form-control" placeholder="değer"/>
              </div>
              <div class="col-md-2 d-grid">
                <button class="btn btn-primary" onclick="saveCredential()">Kaydet</button>
                <button class="btn btn-outline-danger mt-2" onclick="deleteCredential()">Sil</button>
              </div>
            </div>
            <div class="mt-3">
              <h6>Zorunlu Tipler</h6>
              <ul id="requiredTypes" class="mb-0"></ul>
            </div>
            <div class="mt-2 text-muted" id="credMsg"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="mt-3">
      <a href="/swagger-ui.html" class="btn btn-outline-secondary">Swagger UI</a>
      <a href="/materials.html" class="btn btn-success ms-2">Malzeme Yönetimi</a>
      <a href="/boms.html" class="btn btn-info ms-2">BOM Yönetimi</a>
      <a href="/atp.html" class="btn btn-warning ms-2">ATP Yönetimi</a>
      <a href="/suppliers.html" class="btn btn-success ms-2">Tedarikçi Yönetimi</a>
      <a href="/stock-movements.html" class="btn btn-info ms-2">Stok Hareketleri</a>
      <a href="/admin-users.html" class="btn btn-primary ms-2">Kullanıcı Yönetimi</a>
    </div>
  </div>
</body>
</html>


